<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Deposit History</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-blue-100 min-h-screen font-sans">

  <header class="bg-blue-700 text-white shadow-md py-4 px-6 flex justify-between items-center">
    <h1 class="text-2xl font-bold">ðŸ’° Deposit History</h1>
    <button id="backBtn" class="bg-blue-900 hover:bg-blue-950 transition px-4 py-2 rounded text-sm font-medium">
      â¬… Back to Dashboard
    </button>
  </header>

  <main class="flex-grow px-4 py-8 max-w-6xl mx-auto">
    <section class="bg-white rounded-xl shadow-lg p-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Your Past Deposits</h2>

      <div class="overflow-x-auto rounded-md border border-gray-200 max-h-[32rem]">
        <table class="min-w-full text-sm text-left text-gray-700">
          <thead class="bg-gray-100 sticky top-0 z-10">
            <tr>
              <th class="px-4 py-3 border-b font-semibold">Amount (à§³)</th>
              <th class="px-4 py-3 border-b font-semibold">Method</th>
              <th class="px-4 py-3 border-b font-semibold">Transaction ID</th>
              <th class="px-4 py-3 border-b font-semibold">Date & Time</th>
              <th class="px-4 py-3 border-b font-semibold text-center">Status</th>
            </tr>
          </thead>
          <tbody id="historyBody" class="bg-white divide-y divide-gray-100">
            <tr>
              <td colspan="5" class="text-center p-5 text-gray-500">Loading deposit history...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <footer class="text-center text-sm text-gray-500 py-6">
    &copy; 2025 BDWork. All rights reserved.
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import {
      getFirestore,
      collection,
      query,
      where,
      orderBy,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCkYWvYNsg2-CR88Js6gcP2nXfvwI4TW30",
      authDomain: "bdwork-346d3.firebaseapp.com",
      projectId: "bdwork-346d3",
      storageBucket: "bdwork-346d3.appspot.com",
      messagingSenderId: "900963179093",
      appId: "1:900963179093:web:81e42d67bb31d603cc92dc"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const historyBody = document.getElementById("historyBody");
    const backBtn = document.getElementById("backBtn");

    backBtn.addEventListener("click", () => {
      window.location.href = "dashboard.html"; // Change if needed
    });

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      try {
        const depositsRef = collection(db, "deposits");
        const q = query(
          depositsRef,
          where("userId", "==", user.uid),
          orderBy("timestamp", "desc")
        );

        const snapshot = await getDocs(q);

        if (snapshot.empty) {
          historyBody.innerHTML = `<tr><td colspan="5" class="text-center p-5 text-gray-500">No deposit history found.</td></tr>`;
          return;
        }

        let rows = "";
        snapshot.forEach(doc => {
          const d = doc.data();
          const status = d.status || "pending";
          const date = d.timestamp?.toDate().toLocaleString() || "N/A";

          const statusClass =
            status === "approved" ? "text-green-600 font-semibold" :
            status === "rejected" ? "text-red-600 font-semibold" :
            "text-yellow-600 font-medium";

          rows += `
            <tr class="hover:bg-gray-50 transition">
              <td class="px-4 py-3 border-b">à§³${d.amount || 0}</td>
              <td class="px-4 py-3 border-b">${d.method || "N/A"}</td>
              <td class="px-4 py-3 border-b">${d.transactionId || "N/A"}</td>
              <td class="px-4 py-3 border-b">${date}</td>
              <td class="px-4 py-3 border-b text-center ${statusClass}">
                ${status.charAt(0).toUpperCase() + status.slice(1)}
              </td>
            </tr>
          `;
        });

        historyBody.innerHTML = rows;

      } catch (error) {
        historyBody.innerHTML = `<tr><td colspan="5" class="text-center p-5 text-red-600">Error loading history: ${error.message}</td></tr>`;
        console.error(error);
      }
    });
  </script>
</body>
</html>
